.container
  %h1 Issues

  %ol#issues
    - @issues.each do |issue|
      %li.row
        - upvotes = issue.get_likes(vote_scope: :visibility).size
        - downvotes = issue.get_dislikes(vote_scope: :visibility).size
        - votes = upvotes + downvotes
        - interesting = votes > 0 ? ( 100 * ( upvotes - downvotes ) / votes ).round : 100
        - title = "Interesting? #{upvotes} / #{downvotes} (#{interesting}%)"
        - template = "<div class='tooltip #{interesting < 0 ? :negative : :positive}' role='tooltip'><div class='tooltip-arrow'></div><div class='tooltip-inner'></div></div>"
        .votes.col-xs-1{ 'data-toggle' => 'tooltip', 'data-template' => template, title: title }
          .vote.up= link_to '⇧', upvote_issue_path(issue), class: current_user.try(:voted_up_on?, issue, vote_scope: :visibility) ? 'selected' : '', method: :post 
          .vote.down= link_to '⇩', downvote_issue_path(issue), class: current_user.try(:voted_down_on?, issue, vote_scope: :visibility) ? 'selected' : '', method: :post
        .col-xs-8
          .title= link_to issue.title, issue
          - if issue.text.try :present?
            = link_to "#text-#{issue.id}", { 'data-toggle' => :collapse } do
              %i.glyphicon.glyphicon-plus-sign
          %span.author
            %span by
            = link_to issue.author.display, issue.author
          .explanation.collapse{ id: "text-" + issue.id.to_s }= issue.text
        #score.col-xs-1{ 'data-toggle' => 'tooltip', title: 'Approve?' }
          = issue.get_likes(vote_scope: :approval).size
          \/
          = issue.get_dislikes(vote_scope: :approval).size
        .col-xs-1
          - if policy(issue).update?
            = link_to edit_issue_path(issue), { class: [:btn, :'btn-default'], title: 'Edit' } do
              %i.glyphicon.glyphicon-edit

  = link_to 'New Issue', new_issue_path, class: [:btn, :'btn-default']
